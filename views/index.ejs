<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Pokémon Unifil Edition</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/script.js" defer></script>
    <style>
        /* Estilo para o container */
        #game-container {
            text-align: center; /* Centraliza o conteúdo */
            margin-top: 20px; /* Espaçamento acima do container */
        }

        #character-img {
            display: none; /* Inicialmente escondido */
            max-width: 80%; /* Limita o tamanho máximo da imagem */
            height: auto; /* Mantém a proporção da imagem */
            margin: 0 auto; /* Centraliza a imagem horizontalmente */
            margin-bottom: 10px; /* Espaçamento abaixo da imagem do personagem */
        }

        #name-input {
            display: none; /* Inicialmente escondido */
            margin-top: 20px; /* Espaçamento acima do campo de nome */
        }

        /* Mantém a imagem do professor acima do texto */
        #professor-img {
            max-width: 80%; /* Limita o tamanho máximo da imagem */
            height: auto; /* Mantém a proporção da imagem */
        }
    </style>
</head>
<body>
    <div id="game-container">
        <img id="professor-img" src="/images/professor_carvalho.png" alt="Professor Carvalho" />
        <img id="character-img" src="" alt="Personagem" />
        <div id="text-box" onclick="nextText()">
            <p id="game-text"></p>
            <div id="genero" style="display: none;">
                <button type="button" onclick="chooseCharacter('garoto')">Garoto</button>
                <button type="button" onclick="chooseCharacter('garota')">Garota</button>                
            </div>
            <div id="name-input">
                <input type="text" id="player-name" placeholder="Digite seu nome aqui" />
                <button onclick="submitName()">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        let texts = [
            "Olá!ﾠPrazerﾠemﾠconhecê-lo!",
            "Bem-vindoﾠaoﾠmundoﾠPokémon!",
            "MeuﾠnomeﾠéﾠCarvalho,ﾠmasﾠtodoﾠmundoﾠmeﾠchamaﾠdeﾠProfessorﾠPokémon.",
            "EsteﾠmundoﾠéﾠhabitadoﾠporﾠcriaturasﾠchamadasﾠPokémon!",
            "Paraﾠalgumasﾠpessoas,ﾠosﾠPokémonﾠsãoﾠanimaisﾠdeﾠestimação.",
            "Outrosﾠosﾠusamﾠparaﾠbatalhas.ﾠQuantoﾠaﾠmim...",
            "EuﾠestudoﾠosﾠPokémon!",
            "Masﾠprimeiroﾠfala-meﾠsobreﾠvocê.",
            "Agoraﾠdiga-me.ﾠVocêﾠéﾠumﾠGaroto?ﾠOuﾠGarota?",
        ];

        let currentIndex = 0;
        let gender; // Variável para armazenar o gênero

        function nextText() {
            if (currentIndex < texts.length) {
                typeText(texts[currentIndex]); 
                currentIndex++;
            }

            if (currentIndex === texts.length) {
                document.getElementById("genero").style.display = 'block'; // Mostra opções de gênero
            }
        }

        function typeText(message) {
            const gameText = document.getElementById("game-text");
            gameText.innerText = '';
            let index = 0;

            function typeLetter() {
                if (index < message.length) {
                    gameText.innerText += message.charAt(index); 
                    index++;
                    setTimeout(typeLetter, 50); 
                }
            }

            typeLetter(); 
        }

        function chooseCharacter(selectedGender) {
            gender = selectedGender; // Armazena o gênero selecionado
            let genderText = (gender === 'garoto') ? "EntãoﾠvocêﾠéﾠumﾠGaroto!" : "EntãoﾠvocêﾠéﾠumaﾠGarota!";
            typeText(genderText);
            
            // Aguarda 2 segundos para ocultar os botões
            setTimeout(() => {
                document.getElementById("genero").style.display = 'none'; // Esconde os botões de escolha de gênero

                // Define a imagem do personagem com base no gênero
                const characterImg = document.getElementById('character-img');
                characterImg.src = (gender === 'garoto') ? '/images/garoto.png' : '/images/garota.png'; 
                characterImg.style.display = 'block'; // Mostra a imagem do personagem
                characterImg.style.margin = '0 auto'; // Centraliza a imagem

                // Esconde a imagem do professor
                document.getElementById("professor-img").style.display = 'none';

                // Pergunta o nome do jogador
                typeText("Gostariaﾠdeﾠsaberﾠseuﾠnomeﾠagora.");
                document.getElementById("name-input").style.display = 'block'; // Exibe o campo para nome

                // A partir desse momento, vamos desativar a função de clique na caixa de texto
                document.getElementById("text-box").onclick = null; // Remove o evento de clique
            }, 2000); 
        }
        fetch('/api/treinadores')
    .then(response => response.json())
    .then(data => {
        console.log("Lista de treinadores:", data); // Veja os treinadores no console
    })
    .catch(error => {
        console.error("Erro ao buscar treinadores:", error);
    });

        function submitName() {
    const playerName = document.getElementById("player-name").value;
    if (playerName) {
        sessionStorage.setItem('nome', playerName);
        sessionStorage.setItem('genero', gender);

        // Enviar dados do treinador para o servidor
        fetch('/api/treinador', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                nome: playerName,
                genero: gender,
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao criar treinador');
            }
            return response.json();
        })
        .then(data => {
            // Exibir mensagem de sucesso e redirecionar
            console.log(data.message);
            const gameText = document.getElementById('game-text');
            const message = `SuaﾠprópriaﾠlendaﾠPokémonﾠestáﾠprestesﾠaﾠcomeçar!ﾠUmﾠmundoﾠdeﾠsonhosﾠeﾠaventurasﾠlheﾠaguardaﾠ${playerName}.ﾠVamosﾠlá!`;
            typeText(message);

            setTimeout(() => {
                window.location.href = '/pokedex';
            }, 9000);
        })
        .catch(error => {
            alert(error.message);
        });
    } else {
        alert("Por favor, digite um nome!");
    }
}


        window.onload = nextText;
    </script>
</body>
</html>
